<!doctype html>
<html lang="en" data-theme="light">
    <head>
        <meta charset="UTF-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1.0" />
        <title>Design System Preview</title>

        <!-- Link to Google Fonts for 'Inter' -->
        <link rel="preconnect" href="https://fonts.googleapis.com" />
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
        <link
            href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700&display=swap"
            rel="stylesheet"
        />

        <!-- Theme and component stylesheets -->
        <link id="theme-link" rel="stylesheet" href="../tokens/cms-theme.css" />
        <link rel="stylesheet" href="../components/button.css" />
        <link rel="stylesheet" href="../components/form.css" />
        <link rel="stylesheet" href="../components/dropdown.css" />

        <!-- jQuery CDN -->
        <script
            src="https://code.jquery.com/jquery-3.7.1.min.js"
            integrity="sha256-/JqT3SQfawRcv/BIHPThkBvs0OEvtFFmqPF/lYI/Cxo="
            crossorigin="anonymous"
        ></script>

        <style>
            /* Basic styles for the documentation page itself */
            body {
                font-family: var(--font-family-sans);
                background-color: var(--theme-bg);
                color: var(--theme-text-primary);
                transition:
                    background-color var(--transition-speed),
                    color var(--transition-speed);
                padding: 2rem;
            }
            h1 {
                color: var(--theme-text-primary);
                margin-bottom: 1rem;
            }
            h2 {
                font-size: 1.25rem;
                margin-bottom: 0.25rem;
            }
            p {
                font-size: var(--font-size-caption);
                color: var(--theme-text-secondary);
                margin: 0;
            }
            .theme-section {
                background-color: var(--theme-surface);
                padding: 2rem;
                border-radius: var(--border-radius);
                margin-top: 1.5rem;
                margin-bottom: 2rem;
                border: 1px solid var(--theme-border);
                transition:
                    background-color var(--transition-speed),
                    border-color var(--transition-speed);
            }
            .controls {
                display: flex;
                gap: 1.5rem;
                align-items: center;
                padding: 1rem;
                background-color: var(--theme-surface);
                border-radius: var(--border-radius);
                border: 1px solid var(--theme-border);
            }
            select {
                font-family: var(--font-family-sans);
                padding: 8px 12px;
                border-radius: 6px;
                border: 1px solid var(--theme-border);
                background-color: var(--theme-bg);
                color: var(--theme-text-primary);
            }

            /* Component Showcase Styles */
            .component-header {
                display: flex;
                justify-content: space-between;
                align-items: flex-start;
                margin-bottom: 1.5rem;
            }
            .component-toggle .toggle-btn {
                background-color: var(--theme-surface);
                border: 1px solid var(--theme-border);
                padding: 6px 12px;
                cursor: pointer;
                color: var(--theme-text-secondary);
                font-size: 14px;
                transition:
                    background-color var(--transition-speed),
                    color var(--transition-speed);
            }
            .component-toggle .toggle-btn:first-child {
                border-top-left-radius: 6px;
                border-bottom-left-radius: 6px;
            }
            .component-toggle .toggle-btn:last-child {
                border-top-right-radius: 6px;
                border-bottom-right-radius: 6px;
                border-left: none;
            }
            .component-toggle .toggle-btn.active {
                background-color: var(--theme-accent);
                color: var(--theme-accent-contrast);
                border-color: var(--theme-accent);
            }
            .component-preview {
                display: flex;
                flex-direction: column;
                align-items: center;
                padding: 1.5rem;
                border: 1px dashed var(--theme-border);
                border-radius: var(--border-radius);
            }
            .component-code pre {
                background-color: color-mix(
                    in srgb,
                    var(--theme-bg) 95%,
                    black 5%
                );
                color: var(--theme-text-secondary);
                padding: 1rem;
                border-radius: var(--border-radius);
                white-space: pre-wrap;
                word-wrap: break-word;
                font-family: var(--font-family-mono);
                font-size: 14px;
            }

            /* Color Palette Styles */
            .palette-grid {
                display: grid;
                grid-template-columns: repeat(auto-fill, minmax(200px, 1fr));
                gap: 1rem;
            }
            .color-swatch {
                padding: 1rem;
                border-radius: var(--border-radius);
                border: 1px solid var(--theme-border);
                box-shadow: 0 2px 4px rgba(0, 0, 0, 0.05);
            }
            .color-swatch .variable {
                font-family: var(--font-family-mono);
                font-size: 14px;
                font-weight: bold;
                margin-bottom: 0.5rem;
            }
            .color-swatch .hex {
                font-family: var(--font-family-mono);
                font-size: 13px;
                opacity: 0.9;
            }
        </style>
    </head>
    <body>
        <h1>Design System Preview</h1>

        <div class="controls">
            <div>
                <label for="theme-switcher">Theme:</label>
                <select id="theme-switcher">
                    <option value="cms" selected>CMS</option>
                    <option value="saas">SaaS</option>
                </select>
            </div>
            <div>
                <label for="mode-switcher">Mode:</label>
                <select id="mode-switcher">
                    <option value="light" selected>Light</option>
                    <option value="dark">Dark</option>
                </select>
            </div>
        </div>

        <div class="theme-section">
            <h2>Components</h2>
            <div class="component-preview">
                <h3 class="component-title">Button</h3>
                <button class="btn btn-primary">Primary Button</button>
                <hr class="component-divider" />

                <h3 class="component-title">Form Elements</h3>
                <div class="form-showcase">
                    <div class="form-group">
                        <label class="form-label" for="sample-input"
                            >Email Address</label
                        >
                        <input
                            type="email"
                            id="sample-input"
                            class="form-input"
                            placeholder="you@example.com"
                        />
                        <p class="form-description">
                            We'll only use this for spam.
                        </p>
                    </div>
                    <div class="form-group">
                        <label class="form-label">Billing Cycle</label>
                        <div class="dropdown" id="billing-dropdown">
                            <button class="dropdown-button">
                                <span class="dropdown-selected-text"
                                    >Monthly</span
                                >
                                <span class="dropdown-arrow">â–¼</span>
                            </button>
                            <div class="dropdown-panel">
                                <div
                                    class="dropdown-option is-selected"
                                    data-value="monthly"
                                >
                                    Monthly
                                </div>
                                <div
                                    class="dropdown-option"
                                    data-value="yearly"
                                >
                                    Yearly
                                </div>
                                <div
                                    class="dropdown-option"
                                    data-value="quarterly"
                                >
                                    Quarterly
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <div class="theme-section">
            <h2>Color Palette</h2>
            <div id="palette-container" class="palette-grid">
                <!-- Color swatches will be dynamically generated here -->
            </div>
        </div>

        <script>
            $(document).ready(function () {
                // --- THEME & MODE SWITCHER LOGIC (Vanilla JS) ---
                const themeSwitcher = document.getElementById("theme-switcher");
                const modeSwitcher = document.getElementById("mode-switcher");
                const themeLink = document.getElementById("theme-link");

                function displayPalette(theme) {
                    const paletteContainer = $("#palette-container");
                    const colorPrefix = theme === "cms" ? "--warm-" : "--cool-";
                    const variables = Array.from(
                        { length: 9 },
                        (_, i) => `${colorPrefix}${i + 1}00`,
                    );

                    paletteContainer.empty(); // Clear previous swatches

                    const rootStyle = getComputedStyle(
                        document.documentElement,
                    );

                    variables.forEach((variable) => {
                        const colorValue = rootStyle
                            .getPropertyValue(variable)
                            .trim();
                        if (!colorValue) return;

                        const swatch = $("<div>", {
                            class: "color-swatch",
                        }).css("background-color", `var(${variable})`);

                        const tempDiv = $("<div>")
                            .css("color", colorValue)
                            .hide()
                            .appendTo("body");
                        const rgbColor = tempDiv.css("color");
                        tempDiv.remove();

                        const rgb = rgbColor.match(/\d+/g).map(Number);
                        const hex =
                            "#" +
                            rgb
                                .map((x) => ("0" + x.toString(16)).slice(-2))
                                .join("");

                        const brightness =
                            (rgb[0] * 299 + rgb[1] * 587 + rgb[2] * 114) / 1000;
                        const textColor =
                            brightness > 128
                                ? "var(--theme-text-primary)"
                                : "var(--warm-100, #FFFFFF)";

                        const variableDiv = $("<div>", {
                            class: "variable",
                            text: variable,
                        }).css("color", textColor);
                        const hexDiv = $("<div>", {
                            class: "hex",
                            text: hex.toUpperCase(),
                        }).css("color", textColor);

                        swatch.append(variableDiv, hexDiv);
                        paletteContainer.append(swatch);
                    });
                }

                function applyThemeAndPalette() {
                    const selectedTheme = themeSwitcher.value;
                    const selectedMode = modeSwitcher.value;
                    themeLink.setAttribute(
                        "href",
                        `../tokens/${selectedTheme}-theme.css`,
                    );
                    document.documentElement.setAttribute(
                        "data-theme",
                        selectedMode,
                    );

                    setTimeout(() => displayPalette(selectedTheme), 150);
                }

                $(themeSwitcher).on("change", applyThemeAndPalette);
                $(modeSwitcher).on("change", applyThemeAndPalette);

                // --- DROPDOWN LOGIC (jQuery) ---
                $(".dropdown-button").on("click", function (e) {
                    e.stopPropagation();
                    var $dropdown = $(this).closest(".dropdown");
                    // Close other dropdowns
                    $(".dropdown")
                        .not($dropdown)
                        .removeClass("is-open")
                        .children(".dropdown-panel")
                        .slideUp(150);
                    // Toggle current dropdown
                    $dropdown.toggleClass("is-open");
                    $dropdown.children(".dropdown-panel").slideToggle(150);
                });

                $(".dropdown-option").on("click", function (e) {
                    e.stopPropagation();
                    var $this = $(this);
                    var $dropdown = $this.closest(".dropdown");
                    var newText = $this.text();

                    $dropdown.find(".dropdown-selected-text").text(newText);
                    $dropdown
                        .find(".dropdown-option")
                        .removeClass("is-selected");
                    $this.addClass("is-selected");

                    $dropdown
                        .removeClass("is-open")
                        .children(".dropdown-panel")
                        .slideUp(150);
                });

                $(document).on("click", function (event) {
                    if (!$(event.target).closest(".dropdown").length) {
                        $(".dropdown.is-open")
                            .removeClass("is-open")
                            .children(".dropdown-panel")
                            .slideUp(150);
                    }
                });

                // --- INITIAL LOAD ---
                applyThemeAndPalette();
            });
        </script>
    </body>
</html>
